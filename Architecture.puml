@startuml
skinparam componentStyle rectangle
skinparam wrapWidth 200
skinparam maxMessageSize 150

title Loan Management Module - Component Architecture

' =========================
' Frontends
' =========================
component "Client Web Frontend" as ClientFE

' =========================
' Core Infrastructure
' =========================
component "API Gateway" as APIGW
component "Kafka Event Bus" as Kafka

' =========================
' Backend Services
' =========================
component "Commercial Service" as Commercial
component "Risk Management Service" as Risk
component "Credit Service" as Credit
component "Notification Service" as Notification

' =========================
' OCR Components
' =========================
component "OCR Engine\n(Income & Identity Docs)" as OCR_Commercial
component "OCR Engine\n(Bank Statements & Debts)" as OCR_Risk

' =========================
' Databases (per service)
' =========================
database "User DB" as UserDB
database "Commercial DB" as CommercialDB
database "Risk DB" as RiskDB
database "Credit DB" as CreditDB
database "Notification DB" as NotificationDB

' =========================
' External Systems
' =========================
component "Central Bank API" as CentralBankAPI

' =========================
' Frontend Interactions
' =========================
ClientFE --> APIGW : Submit loan application\nUpload documents

APIGW --> Kafka : Publish events

' =========================
' Event-driven flow
' =========================
Kafka --> Commercial : LoanApplicationSubmitted
Commercial --> Kafka : CommercialScoringCompleted

Kafka --> Risk : CommercialScoringCompleted
Risk --> Kafka : RiskScoringCompleted\n(Approved / Rejected)

Kafka --> Credit : LoanApproved
Credit --> Kafka : CreditContractGenerated

Kafka --> Notification : LoanApproved / Rejected\nContractReady

' =========================
' OCR usage
' =========================
Commercial --> OCR_Commercial : Extract income & identity data
Risk --> OCR_Risk : Extract debts & commitments

' =========================
' Databases
' =========================
Commercial --> CommercialDB
Risk --> RiskDB
Credit --> CreditDB
Notification --> NotificationDB

Commercial --> UserDB
Risk --> UserDB
Credit --> UserDB

' =========================
' External API
' =========================
Risk --> CentralBankAPI : Check outstanding commitments

@enduml
